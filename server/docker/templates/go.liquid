FROM {{ image }}

ENV GOTMPDIR=/opt/gotmpdir GOCACHE=/opt/gocache
RUN mkdir -p /opt/gotmpdir && chown 1000:1000 /opt/gotmpdir
RUN mkdir -p /opt/gocache && chown 1000:1000 /opt/gocache

{{ set_user_and_home_dir }}

RUN go mod init temp
{% if dependencies %}
RUN go get {{ dependencies }}
{% endif %}

COPY --chown=1000:1000 {{ main_file }} .
{% for file in files %}
COPY --chown=1000:1000 {{ file.path }} ./files/{{ file.path }}
{% endfor %}

RUN go build

CMD ["./temp"]
